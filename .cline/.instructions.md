# IGCLWrapper Guide

## Overview

The IGCLWrapper project provides a comprehensive C# wrapper for the Intel Graphics Control Library (IGCL) SDK DLL to allow the C++ DLL to be used within C#. The IGCLWrapper uses SWIG to generate the C# wrappper code. The IGCLWrapper enables application developers to have full access to the IGCL functionality from their C# applications, including GPU management, display control, performance monitoring, and tuning capabilities, and IGCLWrapper avoids the need for the application developers to write their own wrapper DLL.

The IGCLWrapper will primarily be used within the DisplayMagician application to provide access to the Intel GPU and Display Management functiionality so that the DisplayMagician software can control Intel GPUs, and can read and store their settings. 

## Project Tech stack used

### Programming Language

This project is written using the following languages:

#### SWIG Interface file

The SWIG Interface file (IGCLWrapper/IGCLWrapper.i) is written in the SWIG Interface format described here: https://www.swig.org/Doc4.3/SWIGDocumentation.html

#### C#

SWIG generates a C++ Wrapper DLL, and C# binding files (IGCLWrapper/cs_bindings/*.cs)

### Intel IGCL SDK

This project main aim is to provide C# bindings for the Intel IGCL SDK. The Intel IGCL SDK is downloaded and placed into the 'drivers.gpu.control-library' folder by the prepare_igcl.ps1 powershell script. 

The IGCL functionality is described most accurately within the drivers.gpu.control-library/include/igcl_api.h file. This is a C header file that lists the functionality available within the IGCL, and it should be considered your primary source of information about the IGCL. There is also a drivers.gpu.control-library/Samples/inc/GenericIGCLApp.h header file which also has some helpful content that will be useful to understand how to access and setup the IGCL library for use.

You can view documentaion about the IGCL at https://intel.github.io/drivers.gpu.control-library/. This should be your secondary source of information about the IGCL.

You should also review the C/C++ samples in the drivers.gpu.control-library/Samples folder too as they will be useful for you to know, and will show you have to test the IGCL functionality.

### SWIG

This project uses the SWIG project (https://www.swig.org/) to create the wrapper DLL. You can find the documentation for SWIG here: https://www.swig.org/Doc4.3/SWIGDocumentation.html
You can also find tutorials on how to use SWIG here: https://www.swig.org/tutorial.html

SWIG is controlled via the SWIG interface file - that is what drives the output that SWIG generates. If you want to add new features and functions to IGCLWrapper, then you need to do so via the SWIG interface file. 

The SWIG interface file for the IGCLWrapper project is IGCLWrapper/IGCLWrapper/IGCLWrapper.i

Once SWIG is run, it will generate various files as an output. The files that matter to us are the outputs of this process:
- IGCLWrapper/x64/Debug/IGCLWrapper.dll - the compiled c++ wrapper DLL
- IGCLWrapper/cs_bindings/*.cs - the C# binding objects that make it far easier to interact with the compiled c++ wrapper DLL

Those two groups of outputs are the only things that application developers will need to copy to use the IGCLWrapper features.

### MSBuild

This project uses the Microsoft Build functions from Microsoft Visual Studio to build this DLL. The idea is that this project should be able to build within Visual Studio as well as build within VSCode. So it is important that any changes will work in both IDEs.

## Project and Code Guidelines

- CRITICAL: ALWAYS ASK THE USER FOR PERMISSION IF THE ORIGINAL STRATEGY THE USER APPROVED DOESN"T WORK AND YOU WANT TO CHANGE THE STRATEGY YOU USE TO ACHIEVE THE OUTCOME. THE USER MUST APPROVE THAT CHANGE.
- CRITICAL: Never remove IGCLWrapper functionality without asking for permission to do so! This means NEVER remove code from IGCLWrapper/IGCLWrapper/IGCLWrapper.i withhout asking the user for permission to do so.
- After you have made changes to the IGCLWrapper/IGCLWrapper.i file always make sure that you have not lost any previous IGCLWrapper functionality (unless the user has explicitly asked you to remove the behaviour)
- Never truncate large files. If you find that you have truncated a file and have lost some functionality then restore the file back to where it has the full functionality back and then try again.
- Always use type hints in any language which supports them
- All objects available within the cs_bindings *.cs files MUST be able to be serialised and deserialised to JSON using Newtonsoft.Json library.
- Unit tests are required, and are required to pass before PR passes
  - Unit tests should focus on core functionality
  - Unit test should be made in xUnit.net, and should be tested in .net 8.
- Always follow good security practices
- Use scripts to perform actions when available
- Always update documentation if you change functionality
- When using the terminal to execute commands, always remember you are running within a Powershell Terminal on a Windows 11 PC.
- Do not use older Command Terminal commands - use Powershell commands instead.

## Project Structure

```
IGCLWrapper/                # This project's root folder
├── IGCLWrapper/              # Native C++ wrapper DLL project
│   ├── IGCLWrapper.i         # SWIG interface definition
│   ├── IGCLWrapper.vcxproj   # Visual Studio project file to be able to build the DLL and create the binding files from within Visual Studio
│   ├── cs_bindings/*.cs           # Generated SWIG wrapper binding c# classes
│   └── x64/                     # Build output directory
├── IGCLWrapper.Tests/              # IGCLWrapper Unit Test project
│   ├── IGCLWrapper.Tests.csproj   # Visual Studio project file
│   └── *Tests.cs                # Test source files
├── drivers.gpu.control-library/     # Intel IGCL SDK (downloaded from Intel by the rebuild_igcl.bat script)
├── prepare_igcl.ps1            # Script to download IGCL SDK and install SWIG ready for use. Run this first to download required files
├── rebuild_igcl.bat            # Main C++ wrapper build script
├── test_igcl.bat        # C# test build and run script (.NET 8.0)
└── swigwin/                    # SWIG installation directory (it is downloaded by the rebuild_igcl.bat script)
```

## Prerequisites

- Windows 10/11
- Visual Studio 2022 Community (or higher)
- Intel graphics drivers with IGCL support
- Internet connection (for automatic dependency downloads)
- .NET 8.0

**Note:** SWIG 4.3.1 and IGCL SDK are automatically downloaded and installed during the build process.

## Scripts in this Project

### Main Build Scripts

#### `rebuild_igcl.bat`
**Purpose:** Builds the main C++ wrapper DLL (IGCLWrapper.dll)
- Sets up Visual Studio environment using VsDevCmd.bat
- Down
- Builds IGCLWrapper.vcxproj using MSBuild
- Copies output DLL to test directory
- **Output:** 
  - `IGCLWrapper\x64\Debug\IGCLWrapper.dll` - the C++ Wrapper DLL itself
  - `IGCLWrapper\cs_bindings\*.cs` - the C# Binding files that enable the C++ Wrapper DLL to be used

#### `test_igcl.bat`
**Purpose:** Builds and runs the C# test application (.NET 8.0)
- Uses dotnet CLI for .NET 8.0 build and execution
- Verifies .NET 8.0 SDK availability
- Builds IGCLWrapper.Tests.csproj using dotnet build
- Runs the compiled test executable using dotnet run

## Building the Wrapper

### Option 1: Using VSCode

```batch
# Build the C++ wrapper DLL first
.\rebuild_igcl.bat

```

### Option 2: Using Visual Studio

1. Open `IGCLWrapper.sln` in Visual Studio
2. Build the solution (Ctrl+Shift+B)
3. Run the desired test project


## Available Functionality

The wrapper provides access to all IGCL features:

### Display Management
- Display enumeration and properties
- Resolution and refresh rate control
- Color management (gamma, gamut, 3D LUT)
- FreeSync and VRR settings
- HDR and color depth configuration

### GPU Management
- GPU enumeration and information
- Performance monitoring and metrics
- Manual and automatic tuning
- Power management
- Fan control

### 3D Graphics Settings
- Anti-aliasing configuration
- Anisotropic filtering
- Tessellation settings
- Frame rate control
- Image enhancement features

### System Services
- Desktop management
- Application-specific settings
- Event handling and notifications
- I2C communication

## Related Documentation

- [Intel IGCL Documentation](https://intel.github.io/drivers.gpu.control-library/) - Official Intel IGCL SDK documentation
- [SWIG Documentation](https://www.swig.org/Doc4.3/SWIGDocumentation.html) - Official SWIG documentation

